// ASSIGNMENT-3 FROM UDEMY CLASS.

-- Creating a warehouse
CREATE WAREHOUSE EXERCISE_WH
WITH
WAREHOUSE_SIZE=XSMALL
MAX_CLUSTER_COUNT=3
MIN_CLUSTER_COUNT=1
AUTO_SUSPEND=600
AUTO_RESUME=TRUE
INITIALLY_SUSPENDED=TRUE
COMMENT= "This database is created in order to do udemy exercises and have some hands on experience on it."


-- Creating database
CREATE OR REPLACE DATABASE EXERCISE_DB;

-- Creating schema 
CREATE OR REPLACE SCHEMA SCHEMA_EXERCISE;

--Creating the table
CREATE OR REPLACE TABLE EXERCISE_DB.SCHEMA_EXERCISE.CUSTOMERS (
    ID INT,
    FIRST_NAME VARCHAR,
    LAST_NAME VARCHAR,
    EMAIL VARCHAR,
    AGE INT,
    CITY VARCHAR
);

--Creating the stage object to store s3 bucket.
CREATE OR REPLACE STAGE aws_s3bucket
    url="s3://snowflake-assignments-mc/loadingdata/";

-- Listing all the files present in the aws s3 bucket
LIST @aws_s3bucket;

--Copying the data from the aws stage into the customers table
COPY INTO EXERCISE_DB.SCHEMA_EXERCISE.CUSTOMERS  
    FROM @aws_s3bucket
    file_format = (type=csv 
                   field_delimiter=';' 
                   skip_header=1);

--Selecting the data from the table.
SELECT * FROM EXERCISE_DB.SCHEMA_EXERCISE.CUSTOMERS;

-----------------------------------------------------------------------------------------------------------
// Assignment-4 from udemy
CREATE OR REPLACE STAGE aws_2
url="s3://snowflake-assignments-mc/fileformat/";

-- Creating the file format object inside the database
CREATE OR REPLACE FILE FORMAT EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format
type='CSV' field_delimiter='|' skip_header=1;

--Describing the file format object.
DESC FILE FORMAT EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format;

-- Altering the file formate object but it cannot be alter.
ALTER FILE FORMAT EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format 
SET type='csv' field_delimiter='|' skip_header=1;

--Listing the files present in the aws bucket
LIST @aws_2;

--Copying the data from the aws bucket to the table
COPY INTO EXERCISE_DB.SCHEMA_EXERCISE.CUSTOMERS
FROM @aws_2
file_format = (FORMAT_NAME=EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format);

-----------------------------------------------------------------------------------------------------------
--Creating a table 
CREATE TABLE EXERCISE_DB.SCHEMA_EXERCISE.EMPLOYEES(
FIRST_NAME VARCHAR(50),
LAST_NAME VARCHAR(50),
EMAIL VARCHAR(50),
AGE INT,
DEPARTMENT VARCHAR(50)
);

--Creating the stage object
CREATE OR REPLACE STAGE EXERCISE_DB.SCHEMA_EXERCISE.aws_3
url = 's3://snowflake-assignments-mc/copyoptions/example1';

--Listing the files 
LIST @EXERCISE_DB.SCHEMA_EXERCISE.aws_3;

-- Creating the file format object 
CREATE OR REPLACE FILE FORMAT EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format_2
type = 'CSV'
field_delimiter = ','
skip_header = 1;

-- Using copy into command to validate if there is any error in the file or not and if there is one then what is the error
COPY INTO EXERCISE_DB.SCHEMA_EXERCISE.EMPLOYEES
FROM @EXERCISE_DB.SCHEMA_EXERCISE.aws_3
FILE_FORMAT = (FORMAT_NAME= 'EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format_2')
VALIDATION_MODE = RETURN_ERRORS;


-------------------------------------------------------------------------------------
                                --ASSIGNMENT-7
-------------------------------------------------------------------------------------

--Creating a stage to point to the specific url
CREATE OR REPLACE STAGE EXERCISE_DB.SCHEMA_EXERCISE.aws_4
url = 's3://snowflake-assignments-mc/unstructureddata/';

--Creating a file format object 
CREATE OR REPLACE FILE FORMAT EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format_3
type='JSON';

--Creating a table with one coloumn
CREATE OR REPLACE TABlE EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW(
raw VARIANT
);

--Copying the raw data into the table
COPY INTO EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW 
FROM @EXERCISE_DB.SCHEMA_EXERCISE.aws_4
FILE_FORMAT = (FORMAT_NAME='EXERCISE_DB.SCHEMA_EXERCISE.aws_file_format_3');

--Selecting data from the tables
SELECT * FROM EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW;



-------------------------------------------------------------------------------------
                                --ASSIGNMENT-8
-------------------------------------------------------------------------------------

--Selecting  attributes first_name last_name skills and query these columns.
SELECT 
raw:first_name::STRING as firstName,
raw:last_name::STRING as LastName,
raw:Skills::STRING as SKILLS
FROM EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW;

--Selecting  attributes first_name last_name skills and query these columns.
SELECT 
raw:first_name::STRING as FIRSTNAME,
raw:last_name::STRING as LASTNAME,
raw:Skills[0]::STRING as SKILL_1,
raw:Skills[1]::STRING as SKILL_2
FROM EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW;

--Creating table and Inserting the values to it as mentioned above in SQL statement
CREATE OR REPLACE TABLE EXERCISE_DB.SCHEMA_EXERCISE.SKILLS
AS 
SELECT
raw:first_name::STRING as FIRSTNAME,
raw:last_name::STRING as LASTNAME,
raw:Skills[0]::STRING as SKILL_1,
raw:Skills[1]::STRING as SKILL_2
FROM EXERCISE_DB.SCHEMA_EXERCISE.JSON_RAW;

--Selecting values from the table 
SELECT * FROM EXERCISE_DB.SCHEMA_EXERCISE.SKILLS;

